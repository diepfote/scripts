#!/usr/bin/env bash


if which kubectl >/dev/null; then
  binary=kubectl
elif which oc >/dev/null; then
  binary=oc
else
  echo -e "${RED}Missing kubectl and oc binaries!\nPlugin needs at least one.$NC" >&2
  exit 1
fi


tmp_dir="$(mktemp -d)"
filename="$tmp_dir/whatever".yaml

cleanup () {
  kill %%  2>/dev/null
  # rm -rf "$tmp_dir"
  echo "$tmp_dir"
}
trap cleanup EXIT

namespace="$2"
pod="$3"
"$binary" proxy &
"$binary" get pod "$@" -o yaml > "$filename"

sed -i "#- batch.kubernetes.io/job-tracking#d"  "$filename"
# less "$filename"

unset HTTPS_PROXY HTTP_PROXY ALL_PROXY https_proxy http_proxy
curl -X PUT --data-binary @"$filename" http://localhost:8001/api/v1/namespaces/"$namespace"/pods/"$pod" -H "Content-Type: application/yaml"
echo


