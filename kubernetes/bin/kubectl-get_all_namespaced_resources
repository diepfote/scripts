#!/usr/bin/env bash

set -o pipefail  # propagate errors
set -u  # exit on undefined
set -e  # exit on non-zero return value
#set -f  # disable globbing/filename expansion
shopt -s failglob  # error on unexpaned globs

if which kubectl >/dev/null; then
  binary=kubectl
elif which oc >/dev/null; then
  binary=oc
else
  echo -e "${RED}Missing kubectl and oc binaries!\nPlugin needs at least one.$NC" >&2
  exit 1
fi

# Parse arguments
positional_args=()
while [ $# -gt 0 ]; do
key="$1"
  case "$key" in
    -n|--namespace)
    positional_args+=("$1") # save in an array for later
    positional_args+=("$2") # save in an array for later
    shift 2
    ;;
    *) # unknown option
    # DROP ALL OTHER
    # positional_args+=("$1") # save in an array for later
    shift
    ;;
  esac
done
set -- "${positional_args[@]}"

"$binary" api-resources --verbs=list --namespaced -o name \
  | xargs -n 1 "$binary" get "$@" --show-kind --ignore-not-found
