#!/usr/bin/env bash

__save_GIT_COMMITTER_EMAIL="$GIT_COMMITTER_EMAIL"
__save_GIT_AUTHOR_EMAIL="$GIT_AUTHOR_EMAIL"
unset GIT_COMMITTER_EMAIL GIT_AUTHOR_EMAIL

cleanup () {
  popd
  GIT_COMMITTER_EMAIL="$__save_GIT_COMMITTER_EMAIL"
  GIT_AUTHOR_EMAIL="$__save_GIT_AUTHOR_EMAIL"
}

trap "cleanup" EXIT

pushd "$1"
shift

git status -sb
echo -e '\n----------------\n'

message="$1"
shift

if [ $# -lt 1 ]; then
  git add .
else
  for path in "$@"; do
    git add "$path"
  done
fi
echo
[ -n "$message" ] && git commit -m "$message" \
  || git commit
echo -e '\n----------------\n'

git status -sb
echo -e '\n----------------\n'

source ~/.sh_functions
git --no-pager l -2 --stat
echo -e '\n----------------\n'

sleep 2
git push

