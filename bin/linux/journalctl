#!/usr/bin/env bash

# all of these stem from https://www.shellcheck.net/wiki/
set -o pipefail  # propagate errors
set -u  # exit on undefined
set -e  # exit on non-zero return value
#set -f  # disable globbing/filename expansion
shopt -s failglob  # error on unexpaned globs
shopt -s inherit_errexit  # Bash disables set -e in command substitution by default; reverse this behavior


KEEP=()
# Parse arguments
USE_TAIL=''
while [ $# -gt 0 ]; do
key="$1"
  case "$key" in
    -f|--follow)
    USE_TAIL=true
    shift
    ;;

    *)
    KEEP+=("$key")
    shift
    ;;
  esac
done

set -- "${KEEP[@]}"


cleanup () { set +x; }
trap cleanup EXIT

if [ -z "$USE_TAIL" ]; then
  set -x
  /usr/bin/journalctl --no-pager --full "$@" | less -R
else
  set -x
  /usr/bin/journalctl --full -f "$@"
fi

