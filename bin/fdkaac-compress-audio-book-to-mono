#!/usr/bin/env bash

# all of these stem from https://www.shellcheck.net/wiki/
set -o pipefail  # propagate errors
set -u  # exit on undefined
set -e  # exit on non-zero return value
#set -f  # disable globbing/filename expansion
shopt -s failglob  # error on unexpaned globs
shopt -s inherit_errexit  # Bash disables set -e in command substitution by default; reverse this behavior

in="$1"
out="$2"
shift 2
##
#
# ffmpeg -ac ... downmix to mono
#
# https://www.perplexity.ai/search/create-a-script-that-uses-ffmp-ClCrmP4nQDS8T5OL0H0ROA#1
# fdkaac -m, --bitrate-mode <n>
#   0 = CBR (default).
#   1â€“5 = VBR; higher = higher average bitrate and quality.
#
# fdkaac --profile 5 ... aac lc for channels >= 32 kb/s
#
ffmpeg -i "$in" -ac 1 -f wav - |  fdkaac -m 2 --profile 5 -o "$out" -

