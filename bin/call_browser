#!/usr/bin/env bash

set -o pipefail  # propagate errors
set -u  # exit on undefined
set -e  # exit on non-zero return value
#set -f  # disable globbing/filename expansion
shopt -s failglob  # error on unexpaned globs

additional_args=()

if [ "$(uname)" = Darwin ]; then

  if [ $# -lt 2 ]; then
    # open in incognito window by default
    url="$1"
    set -- "$url" -i
  else
    # last arg is assumed to be the url
    url="${@:$#}"
    set -- "$url" -n
  fi

  set -x
  /usr/local/bin/chrome-cli open "$@"  1>/dev/null 2>&1
  set +x
else
  source ~/Documents/scripts/source-me/linux/posix-compliant-shells.sh
  # -N ... allow network access

  url="$1"

  set -x
  firewardened-chromium -N "$url"  >/dev/null 2>&1  &
  set +x
fi

# block so external scripts do not delete the file yet
sleep 2

