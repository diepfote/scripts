#!/usr/bin/env bash

# all of these stem from https://www.shellcheck.net/wiki/
set -o pipefail  # propagate errors
set -u  # exit on undefined
set -e  # exit on non-zero return value
#set -f  # disable globbing/filename expansion
shopt -s failglob  # error on unexpaned globs
shopt -s inherit_errexit  # Bash disables set -e in command substitution by default; reverse this behavior

_is_not_hevc() {
  if [ "$(ffprobe-get-vcodec "$1")" != hevc ]; then
      realpath "$1"
  fi
}

_help() {
cat <<EOF
USAGE: $(basename $0) <FILE>
USAGE: $(basename $0) <DIRs for find>

EOF
}

if [ $# -eq 0 ]; then
  _help
  exit
fi

if [ -d "$1" ]; then
  while read -r line; do
    _is_not_hevc "$line"
  done < <(find "$@" -iname '*.mp4')
else
  _is_not_hevc "$1"
fi


